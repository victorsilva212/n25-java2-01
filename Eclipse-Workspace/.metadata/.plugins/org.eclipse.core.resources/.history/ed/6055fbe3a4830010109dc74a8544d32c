package br.com.senaisp.bauru.victor.classes;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.util.ArrayList;
import java.util.List;

import com.mysql.cj.xdevapi.PreparableStatement;

public class Produto {
	private int id;
	private String descricao;
	private double saldo;
	private double preco;
	private ConectorBancoDados conn;
	//Constructor
	public Produto(String descricao, double saldo, 
			double preco) throws SQLException {
		this.id = 0;
		this.descricao = descricao;
		this.saldo = saldo;
		this.preco = preco;
		conn = ConectorBancoDados.getInstancia();
	}
	public String getDescricao() {
		return descricao;
	}
	public void setDescricao(String descricao) {
		this.descricao = descricao;
	}
	public double getSaldo() {
		return saldo;
	}
	public void setSaldo(double saldo) {
		this.saldo = saldo;
	}
	public double getPreco() {
		return preco;
	}
	public void setPreco(double preco) {
		this.preco = preco;
	}
	public int getId() {
		return id;
	}
	public ConectorBancoDados getConn() {
		return conn;
	}
	private void setId(int value) {
		id = value;
	}
	//MÃ©todos
	public static Produto create(String descricao,double saldo,double preco) throws SQLException {
		Produto prd = new Produto(descricao, saldo, preco);
		//Disparando o sql para inserir o registro
		Connection co = prd.getConn().getConnection();
		String sql = "insert into produto(descricao,saldo,preco) "
				+ "values (?,?,?)";
		//Preparando para executar
		PreparedStatement stmt = co.prepareStatement(sql,Statement.RETURN_GENERATED_KEYS);
		//Setar os valores das ?
		stmt.setString(1, descricao);
		stmt.setDouble(2, saldo);
		stmt.setDouble(3, preco);
		//Disparando o sql
		int linhasAfetadas = stmt.executeUpdate();
		System.out.println("Inseri "+ linhasAfetadas + " no banco");
		//Obtendo o id gerado
		ResultSet res = stmt.getGeneratedKeys();
		res.next();
		//Obtendo o valor do Id e setando no field Id do Produto
		prd.setId(res.getInt(1));
		return prd;
	}
	
	public static List<Produto> listarProdutos(){
		ArrayList<Produto> prd = new ArrayList<Produto>();
		try {
			Connection co = ConectorBancoDados.getInstancia().getConnection();
			String sql = "select id, descricao, saldo, "
					+ " preco from produto order by id desc";
			PreparedStatement stmt = co.prepareStatement(sql);
			//Disparando o sql de consulta
			ResultSet rs = stmt.executeQuery();
			Produto prd = parseResultado(rs);
		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		
		return prd;
	}
	private static Produto parseResultado(ResultSet rs) throws SQLException {
		return new Produto(rs.getString(1),rs.getDouble(2),rs.getDouble(3));
	}
}
